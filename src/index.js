import Player from './Player'
import WebGLPlayer from './webglPlayer'

window.testWebGLRender = function testWebGLRender() {
    const canvas = document.getElementById('videoCanvas')
    const webglPlayer = new WebGLPlayer(canvas)

    // black
    webglPlayer.feedSrc('data:image/png;base64,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')
}

window.loadPCM = function loadPCM() {
    // 建立 WebSocket 连接

    const socket = new WebSocket('ws://nas.maituai.com:15888/ws')

    // 获取 Canvas 和音频播放器
    const canvas = document.getElementById('videoCanvas')

    const player = new Player(canvas)
    let playInterval

    console.log('loadPCM')
    socket.onmessage = function (event) {
        event.data.arrayBuffer().then((buffer) => {
            player.readAndMockPTS(buffer)
        })

        // delay 1s to play
        if (!playInterval) {
            playInterval = setTimeout(() => {
                console.log('play')
                player.play()
            }, 1000)
        }
    }
}
